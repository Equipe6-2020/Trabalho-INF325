# Queries Neo4J

- DELETE ALL nodes
```cypher
MATCH (n)
DETACH DELETE n
```

CALL apoc.load.json("dataset/olist_customers_dataset.json") yield value
UNWIND value as customer
WITH (customer)
WHERE customer.customer_city in ["campinas", "sao paulo"]
MERGE (cliente:Cliente {id:customer.customer_id}) ON CREATE SET cliente.nome = customer.customer_id
MERGE (regiao:Regiao {id:customer.customer_zip_code_prefix}) ON CREATE SET regiao.nome = customer.customer_zip_code_prefix
MERGE (cidade: Cidade {id:customer.customer_city}) ON CREATE SET cidade.nome = customer.customer_city
MERGE (estado: Estado {id:customer.customer_state}) ON CREATE SET estado.nome = customer.customer_estado
MERGE (cliente)-[:RESIDE_EM]->(regiao)
MERGE (regiao)-[:FAZ_PARTE_DE]->(cidade)
MERGE (cidade)-[:DENTRO_DE]->(estado)

CALL apoc.load.json("dataset/olist_orders_dataset.json") yield value
UNWIND value as orderList
WITH (orderList)
MATCH (cliente:Cliente)
WHERE orderList.customer_id = cliente.id
MERGE (pedido:Pedido {id : orderList.order_id}) ON CREATE SET pedido.nome = orderList.order_id
MERGE (cliente)-[:REALIZOU]->(pedido)

CALL apoc.load.json("dataset/olist_order_items_dataset.json") yield value
UNWIND value as orderListItems
WITH (orderListItems)
MATCH (pedido:Pedido)
WHERE orderListItems.order_id = pedido.id
MERGE (itempedido:itempedido {id : orderListItems.order_id + '-' + orderListItems.order_item_id}) 
    ON CREATE SET itempedido.nome = orderListItems.order_id + '-' + orderListItems.order_item_id,
                  itempedido.preco = orderListItems.price,
                  itempedido.produto = orderListItems.product_id,
                  itempedido.fornecedor = orderListItems.seller_id
MERGE (produto:Produto {id: orderListItems.product_id}) 
    ON CREATE SET produto.nome = orderListItems.product_id
MERGE (fornecedor:Fornecedor {id: orderListItems.seller_id})
    ON CREATE SET fornecedor.nome = orderListItems.seller_id
MERGE (itempedido)-[:PERTENCE]->(pedido)
MERGE (produto)-[:ESTA_EM {iditem : orderListItems.ordr_item_id}]->(pedido)
MERGE (produto)-[:EH_VENDIDO]->(fornecedor)
WITH (pedido)
MATCH cliente=()-[:REALIZOU]->(ped)
WHERE ped.id = pedido.id
MERGE (produto)-[:FOI_COMPRADO]->(cliente)

- Construção do database
```cypher
CALL apoc.load.json('https://raw.githubusercontent.com/Equipe6-2020/Trabalho-INF325/mateus/dataset/json_with_relations.json') yield value
MERGE (product:Product{id:value.product.product_id}) ON CREATE SET product.nome = value.product.procuct_id, product.price = value.price
MERGE (categoria:Categoria{id:value.product.product_category_name}) ON CREATE SET categoria.nome = value.product.product_category_name
MERGE (seller:Seller{id:value.seller.seller_id}) ON CREATE SET seller.nome = value.seller_seller_id
MERGE (cidade:Cidade{id:value.seller.seller_city}) ON CREATE SET cidade.nome = value.seller.seller_city
MERGE (regiao:Regiao{id:value.seller.seller_zip_code_prefix}) ON CREATE SET regiao.nome = value.seller.seller_zipcode_prefix
MERGE (product)-[:PERTENCE{order_id:value.order_item_id}]->(categoria)
MERGE (product)-[:PRODUZIDO_POR]->(seller)
MERGE (seller)-[:ESTA]->(cidade)
MERGE (regiao)-[:FAZ_PARTE]->(cidade)
MERGE (produto)-[:E_PRODUZIDO_EM{order_info:value.order_item_id}]->(regiao)
````
